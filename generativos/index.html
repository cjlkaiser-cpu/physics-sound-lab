<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musica Generativa - Physics Sound Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card {
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-4px);
        }
        .variant-btn {
            transition: all 0.2s ease;
        }
        .variant-btn:hover {
            transform: scale(1.02);
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen">
    <!-- Header -->
    <header class="border-b border-gray-800 bg-gray-900/50 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <a href="../index.html" class="text-gray-400 hover:text-white text-sm mb-1 inline-block">← Physics Sound Lab</a>
                    <h1 class="text-2xl font-light">
                        <span class="text-purple-400 font-medium">Musica</span> Generativa
                    </h1>
                </div>
                <a href="https://github.com/cjlkaiser-cpu" target="_blank" class="text-gray-400 hover:text-white transition">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
                </a>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-6 py-12">
        <!-- Intro -->
        <section class="text-center mb-16">
            <p class="text-gray-400 max-w-2xl mx-auto">
                Sistemas donde la fisica, las matematicas y la teoria musical convergen
                para crear composiciones emergentes, unicas e irrepetibles.
            </p>
        </section>

        <!-- Harmonices Mundi -->
        <section class="card bg-gradient-to-r from-amber-900/20 to-orange-900/20 border border-amber-500/30 rounded-2xl p-8 mb-8">
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="flex-1">
                    <span class="text-amber-400 text-sm font-medium tracking-wide">HARMONICES MUNDI</span>
                    <h2 class="text-3xl font-light mt-2 mb-4">
                        <span class="text-amber-400 font-medium">Coro Planetario</span>
                    </h2>
                    <p class="text-gray-400 mb-6">
                        El Sistema Solar completo sonificado segun la vision de Johannes Kepler (1619).
                        8 planetas cantando en armonia con fisica orbital real, FFT spectrum analyzer,
                        y modo Concert Hall inmersivo. Cada planeta genera una nota basada en su
                        velocidad orbital segun las proporciones que Kepler describio hace 400 anos.
                    </p>

                    <div class="flex flex-wrap gap-3 mb-6">
                        <span class="px-3 py-1 bg-amber-500/10 text-amber-400/80 rounded-full text-sm">Kepler 1619</span>
                        <span class="px-3 py-1 bg-amber-500/10 text-amber-400/80 rounded-full text-sm">8 planetas</span>
                        <span class="px-3 py-1 bg-amber-500/10 text-amber-400/80 rounded-full text-sm">FFT Analyzer</span>
                        <span class="px-3 py-1 bg-amber-500/10 text-amber-400/80 rounded-full text-sm">Concert Hall</span>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <a href="https://cjlkaiser-cpu.github.io/harmonices-mundi/" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-amber-500 text-gray-900 rounded-lg font-medium hover:bg-amber-400">
                            ▶ Demo
                        </a>
                        <a href="https://cjlkaiser-cpu.github.io/harmonices-mundi/tutorial.html" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            Tutorial
                        </a>
                        <a href="https://github.com/cjlkaiser-cpu/harmonices-mundi" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            GitHub
                        </a>
                        <a href="../papers/harmonices-mundi/ARTICLE_v1.html" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            Articulo
                        </a>
                    </div>
                </div>
                <div class="lg:w-72">
                    <canvas id="preview-coro" class="w-full h-48 bg-gray-950 rounded-xl"></canvas>
                </div>
            </div>
        </section>

        <!-- Tonnetz Atractor -->
        <section class="card bg-gradient-to-r from-purple-900/20 to-pink-900/20 border border-purple-500/30 rounded-2xl p-8 mb-8">
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="flex-1">
                    <span class="text-purple-400 text-sm font-medium tracking-wide">TONNETZ ATRACTOR</span>
                    <h2 class="text-3xl font-light mt-2 mb-4">
                        <span class="text-purple-400 font-medium">El Atractor del Tonnetz</span>
                    </h2>
                    <p class="text-gray-400 mb-6">
                        Fisica del caos + teoria Neo-Riemanniana = musica emergente.
                        Una particula magnetica orbita un espacio armonico Tonnetz, disparando acordes
                        segun su trayectoria caotica. Disponible en 3 variantes de visualizacion.
                    </p>

                    <div class="flex flex-wrap gap-3 mb-6">
                        <span class="px-3 py-1 bg-purple-500/10 text-purple-400/80 rounded-full text-sm">Neo-Riemannian</span>
                        <span class="px-3 py-1 bg-purple-500/10 text-purple-400/80 rounded-full text-sm">Atractor caotico</span>
                        <span class="px-3 py-1 bg-purple-500/10 text-purple-400/80 rounded-full text-sm">5 modos</span>
                    </div>

                    <!-- Variantes -->
                    <div class="space-y-3 mb-6">
                        <h4 class="text-sm text-gray-500 font-medium">VARIANTES</h4>

                        <a href="https://cjlkaiser-cpu.github.io/tonnetz-atractor/" target="_blank"
                           class="variant-btn block p-4 bg-gray-800/50 hover:bg-gray-800 rounded-xl border border-gray-700/50">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-white font-medium">Hexagonal</span>
                                    <span class="text-purple-400 text-xs ml-2">principal</span>
                                    <p class="text-gray-500 text-sm mt-1">Tonnetz clasico con hexagonos. Interfaz original.</p>
                                </div>
                                <span class="text-purple-400">→</span>
                            </div>
                        </a>

                        <a href="https://cjlkaiser-cpu.github.io/tonnetz-atractor/tonnetz-grid.html" target="_blank"
                           class="variant-btn block p-4 bg-gray-800/50 hover:bg-gray-800 rounded-xl border border-gray-700/50">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-white font-medium">Grid</span>
                                    <p class="text-gray-500 text-sm mt-1">Visualizacion en cuadricula. Relaciones mas claras.</p>
                                </div>
                                <span class="text-purple-400">→</span>
                            </div>
                        </a>

                        <a href="https://cjlkaiser-cpu.github.io/tonnetz-atractor/tonnetz-chromatic.html" target="_blank"
                           class="variant-btn block p-4 bg-gray-800/50 hover:bg-gray-800 rounded-xl border border-gray-700/50">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-white font-medium">Chromatic</span>
                                    <p class="text-gray-500 text-sm mt-1">Circulo cromatico. Visualiza relaciones de quinta.</p>
                                </div>
                                <span class="text-purple-400">→</span>
                            </div>
                        </a>

                        <a href="tonnetz-atractor/tonnetz-dual.html"
                           class="variant-btn block p-4 bg-gray-800/50 hover:bg-gray-800 rounded-xl border border-gray-700/50">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="text-white font-medium">Dual</span>
                                    <span class="text-pink-400 text-xs ml-2">nuevo</span>
                                    <p class="text-gray-500 text-sm mt-1">Dos particulas independientes. Polifonia caotica.</p>
                                </div>
                                <span class="text-purple-400">→</span>
                            </div>
                        </a>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <a href="https://cjlkaiser-cpu.github.io/tonnetz-atractor/tutorial.html" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            Tutorial
                        </a>
                        <a href="https://github.com/cjlkaiser-cpu/tonnetz-atractor" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            GitHub
                        </a>
                        <a href="../papers/paper-tonnetz-atractor/ARTICLE_v1.html" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            Articulo
                        </a>
                    </div>
                </div>
                <div class="lg:w-72">
                    <canvas id="preview-tonnetz" class="w-full h-48 bg-gray-950 rounded-xl"></canvas>
                </div>
            </div>
        </section>

        <!-- Rameau Machine -->
        <section class="card bg-gradient-to-r from-green-900/20 to-emerald-900/20 border border-green-500/30 rounded-2xl p-8 mb-8">
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="flex-1">
                    <span class="text-green-400 text-sm font-medium tracking-wide">RAMEAU MACHINE</span>
                    <h2 class="text-3xl font-light mt-2 mb-4">
                        <span class="text-green-400 font-medium">Armonia Funcional</span>
                    </h2>
                    <p class="text-gray-400 mb-6">
                        Sistema generativo basado en las teorias de Jean-Philippe Rameau (1722).
                        Contrapunto al Tonnetz: en lugar de simetria Neo-Riemanniana, implementa
                        armonia funcional jerarquica donde la tonica actua como centro gravitacional.
                        Cadenas de Markov con pesos dinamicos segun tension acumulada.
                    </p>

                    <div class="flex flex-wrap gap-3 mb-6">
                        <span class="px-3 py-1 bg-green-500/10 text-green-400/80 rounded-full text-sm">Rameau 1722</span>
                        <span class="px-3 py-1 bg-green-500/10 text-green-400/80 rounded-full text-sm">T-S-D Funciones</span>
                        <span class="px-3 py-1 bg-green-500/10 text-green-400/80 rounded-full text-sm">Voice Leading SATB</span>
                        <span class="px-3 py-1 bg-green-500/10 text-green-400/80 rounded-full text-sm">4 estilos</span>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <a href="rameau-machine/index.html"
                           class="variant-btn px-5 py-2.5 bg-green-500 text-gray-900 rounded-lg font-medium hover:bg-green-400">
                            Demo
                        </a>
                        <a href="rameau-machine/README.md" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            README
                        </a>
                        <a href="../papers/paper-rameau-machine/ARTICLE_v1.html" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            Articulo
                        </a>
                    </div>
                </div>
                <div class="lg:w-72">
                    <canvas id="preview-rameau" class="w-full h-48 bg-gray-950 rounded-xl"></canvas>
                </div>
            </div>
        </section>

        <!-- Orbifold Walker -->
        <section class="card bg-gradient-to-r from-blue-900/20 to-indigo-900/20 border border-blue-500/30 rounded-2xl p-8 mb-8">
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="flex-1">
                    <span class="text-blue-400 text-sm font-medium tracking-wide">ORBIFOLD WALKER</span>
                    <h2 class="text-3xl font-light mt-2 mb-4">
                        <span class="text-blue-400 font-medium">Tymoczko Chord Space</span>
                    </h2>
                    <p class="text-gray-400 mb-6">
                        Exploracion del espacio de orbifolds de Dmitri Tymoczko. Una particula se mueve
                        en el prisma 3D donde cada punto representa un voicing concreto de triada.
                        Los acordes consonantes (mayor, menor, dim, aug) actuan como atractores.
                        Voice leading suave = distancia corta en el espacio geometrico.
                    </p>

                    <div class="flex flex-wrap gap-3 mb-6">
                        <span class="px-3 py-1 bg-blue-500/10 text-blue-400/80 rounded-full text-sm">Tymoczko</span>
                        <span class="px-3 py-1 bg-blue-500/10 text-blue-400/80 rounded-full text-sm">Three.js 3D</span>
                        <span class="px-3 py-1 bg-blue-500/10 text-blue-400/80 rounded-full text-sm">Orbifold T³/S₃</span>
                        <span class="px-3 py-1 bg-blue-500/10 text-blue-400/80 rounded-full text-sm">Drone/Trigger</span>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <a href="orbifold-walker/index.html"
                           class="variant-btn px-5 py-2.5 bg-blue-500 text-gray-900 rounded-lg font-medium hover:bg-blue-400">
                            ▶ Demo
                        </a>
                        <a href="../papers/paper-orbifold-walker/ARTICLE_v1.html" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            Articulo
                        </a>
                    </div>
                </div>
                <div class="lg:w-72">
                    <canvas id="preview-orbifold" class="w-full h-48 bg-gray-950 rounded-xl"></canvas>
                </div>
            </div>
        </section>

        <!-- Cadencia Orbital -->
        <section class="card bg-gradient-to-r from-cyan-900/20 to-green-900/20 border border-cyan-500/30 rounded-2xl p-8 mb-8">
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="flex-1">
                    <span class="text-cyan-400 text-sm font-medium tracking-wide">CADENCIA ORBITAL</span>
                    <h2 class="text-3xl font-light mt-2 mb-4">
                        <span class="text-cyan-400 font-medium">Progresiones Orbitales</span>
                    </h2>
                    <p class="text-gray-400 mb-6">
                        Multi-atractores gravitacionales + progresiones armonicas. Particulas orbitan
                        entre 3-8 atractores que representan grados tonales (I, ii, iii, IV, V, vi, vii°),
                        disparando acordes al cruzar sectores. Zonas de modulacion automatica al centro
                        (relativo) y exterior (dominante).
                    </p>

                    <div class="flex flex-wrap gap-3 mb-6">
                        <span class="px-3 py-1 bg-cyan-500/10 text-cyan-400/80 rounded-full text-sm">RK4 Physics</span>
                        <span class="px-3 py-1 bg-cyan-500/10 text-cyan-400/80 rounded-full text-sm">Circulo de quintas</span>
                        <span class="px-3 py-1 bg-cyan-500/10 text-cyan-400/80 rounded-full text-sm">Mayor/Menor</span>
                        <span class="px-3 py-1 bg-cyan-500/10 text-cyan-400/80 rounded-full text-sm">Grabacion</span>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <a href="cadencia-orbital/cadencia-orbital.html"
                           class="variant-btn px-5 py-2.5 bg-cyan-500 text-gray-900 rounded-lg font-medium hover:bg-cyan-400">
                            ▶ Demo
                        </a>
                        <a href="cadencia-orbital/README.md" target="_blank"
                           class="variant-btn px-5 py-2.5 bg-gray-800 text-gray-200 rounded-lg font-medium hover:bg-gray-700">
                            README
                        </a>
                    </div>
                </div>
                <div class="lg:w-72">
                    <canvas id="preview-cadencia" class="w-full h-48 bg-gray-950 rounded-xl"></canvas>
                </div>
            </div>
        </section>

        <!-- Tech Stack -->
        <section class="text-center mt-12">
            <h3 class="text-lg font-medium mb-4 text-gray-500">Tecnologias</h3>
            <div class="flex flex-wrap justify-center gap-3">
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Canvas 2D</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Three.js</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Web Audio API</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">FFT Analyser</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Ecuaciones de Kepler</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Neo-Riemannian Theory</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Tymoczko Orbifolds</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Sistemas caoticos</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">RK4 Integration</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">MediaRecorder</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Rameau Funcional</span>
                <span class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-400">Markov Chains</span>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="border-t border-gray-800 py-6 mt-12">
        <div class="max-w-5xl mx-auto px-6 text-center text-gray-500 text-sm">
            Physics Sound Lab · Musica Generativa
        </div>
    </footer>

    <script>
        let time = 0;
        const previews = {};

        function initPreviews() {
            // Coro Planetario
            const coro = document.getElementById('preview-coro');
            if (coro) {
                previews.coro = {
                    ctx: coro.getContext('2d'),
                    w: coro.width = coro.offsetWidth * 2,
                    h: coro.height = coro.offsetHeight * 2
                };
            }

            // Tonnetz
            const tonnetz = document.getElementById('preview-tonnetz');
            if (tonnetz) {
                previews.tonnetz = {
                    ctx: tonnetz.getContext('2d'),
                    w: tonnetz.width = tonnetz.offsetWidth * 2,
                    h: tonnetz.height = tonnetz.offsetHeight * 2,
                    trail: []
                };
            }

            // Cadencia Orbital
            const cadencia = document.getElementById('preview-cadencia');
            if (cadencia) {
                previews.cadencia = {
                    ctx: cadencia.getContext('2d'),
                    w: cadencia.width = cadencia.offsetWidth * 2,
                    h: cadencia.height = cadencia.offsetHeight * 2,
                    trail1: [],
                    trail2: []
                };
            }

            // Orbifold Walker
            const orbifold = document.getElementById('preview-orbifold');
            if (orbifold) {
                previews.orbifold = {
                    ctx: orbifold.getContext('2d'),
                    w: orbifold.width = orbifold.offsetWidth * 2,
                    h: orbifold.height = orbifold.offsetHeight * 2,
                    trail: []
                };
            }

            // Rameau Machine
            const rameau = document.getElementById('preview-rameau');
            if (rameau) {
                previews.rameau = {
                    ctx: rameau.getContext('2d'),
                    w: rameau.width = rameau.offsetWidth * 2,
                    h: rameau.height = rameau.offsetHeight * 2,
                    activeChord: 0,
                    tension: 0
                };
            }
        }

        function animate() {
            time += 0.02;

            // Coro Planetario
            if (previews.coro) {
                const c = previews.coro;
                c.ctx.fillStyle = '#030712';
                c.ctx.fillRect(0, 0, c.w, c.h);

                const cx = c.w / 2, cy = c.h / 2;

                // Sol
                const sunGrad = c.ctx.createRadialGradient(cx, cy, 0, cx, cy, 20);
                sunGrad.addColorStop(0, '#fff');
                sunGrad.addColorStop(0.5, '#fbbf24');
                sunGrad.addColorStop(1, '#f59e0b');
                c.ctx.fillStyle = sunGrad;
                c.ctx.beginPath();
                c.ctx.arc(cx, cy, 15, 0, Math.PI * 2);
                c.ctx.fill();

                const planets = [
                    { r: 30, speed: 4, color: '#a0a0a0', size: 3 },
                    { r: 45, speed: 3, color: '#e6c87a', size: 4 },
                    { r: 60, speed: 2.5, color: '#6b93d6', size: 4 },
                    { r: 80, speed: 2, color: '#c1440e', size: 3.5 },
                    { r: 110, speed: 1, color: '#d8ca9d', size: 8 },
                    { r: 140, speed: 0.7, color: '#f4d59e', size: 7 }
                ];

                planets.forEach(p => {
                    c.ctx.strokeStyle = p.color + '20';
                    c.ctx.lineWidth = 1;
                    c.ctx.beginPath();
                    c.ctx.arc(cx, cy, p.r, 0, Math.PI * 2);
                    c.ctx.stroke();

                    const angle = time * p.speed;
                    const px = cx + p.r * Math.cos(angle);
                    const py = cy + p.r * Math.sin(angle);

                    c.ctx.fillStyle = p.color;
                    c.ctx.beginPath();
                    c.ctx.arc(px, py, p.size, 0, Math.PI * 2);
                    c.ctx.fill();
                });
            }

            // Tonnetz preview (hexagon with orbiting particle)
            if (previews.tonnetz) {
                const t = previews.tonnetz;
                t.ctx.fillStyle = '#030712';
                t.ctx.fillRect(0, 0, t.w, t.h);

                const cx = t.w / 2, cy = t.h / 2;
                const hexR = 60;

                // Draw hexagon
                t.ctx.strokeStyle = '#a855f740';
                t.ctx.lineWidth = 2;
                t.ctx.beginPath();
                for (let i = 0; i < 6; i++) {
                    const angle = (i * Math.PI / 3) - Math.PI / 6;
                    const x = cx + hexR * Math.cos(angle);
                    const y = cy + hexR * Math.sin(angle);
                    if (i === 0) t.ctx.moveTo(x, y);
                    else t.ctx.lineTo(x, y);
                }
                t.ctx.closePath();
                t.ctx.stroke();

                // Nodes at vertices
                for (let i = 0; i < 6; i++) {
                    const angle = (i * Math.PI / 3) - Math.PI / 6;
                    const x = cx + hexR * Math.cos(angle);
                    const y = cy + hexR * Math.sin(angle);
                    t.ctx.fillStyle = '#a855f7';
                    t.ctx.beginPath();
                    t.ctx.arc(x, y, 6, 0, Math.PI * 2);
                    t.ctx.fill();
                }

                // Chaotic orbit
                const orbitR = 40;
                const px = cx + orbitR * Math.sin(time * 2.3) * Math.cos(time * 1.7);
                const py = cy + orbitR * Math.cos(time * 1.9) * Math.sin(time * 2.1);

                t.trail.push({ x: px, y: py });
                if (t.trail.length > 80) t.trail.shift();

                // Trail
                t.ctx.beginPath();
                t.trail.forEach((p, i) => {
                    if (i === 0) t.ctx.moveTo(p.x, p.y);
                    else t.ctx.lineTo(p.x, p.y);
                });
                t.ctx.strokeStyle = '#ec489940';
                t.ctx.lineWidth = 2;
                t.ctx.stroke();

                // Particle
                t.ctx.fillStyle = '#ec4899';
                t.ctx.beginPath();
                t.ctx.arc(px, py, 8, 0, Math.PI * 2);
                t.ctx.fill();
            }

            // Cadencia Orbital preview
            if (previews.cadencia) {
                const c = previews.cadencia;
                c.ctx.fillStyle = '#030712';
                c.ctx.fillRect(0, 0, c.w, c.h);

                const cx = c.w / 2, cy = c.h / 2;
                const radius = 55;
                const numAttractors = 5;

                // Draw attractor circle
                c.ctx.strokeStyle = '#22c55e15';
                c.ctx.lineWidth = 1;
                c.ctx.beginPath();
                c.ctx.arc(cx, cy, radius, 0, Math.PI * 2);
                c.ctx.stroke();

                // Draw sector lines and attractors
                const colors = ['#ef4444', '#f97316', '#fbbf24', '#22c55e', '#06b6d4'];
                const degrees = ['I', 'ii', 'iii', 'IV', 'V'];
                for (let i = 0; i < numAttractors; i++) {
                    const angle = (i / numAttractors) * Math.PI * 2 - Math.PI / 2;
                    const ax = cx + Math.cos(angle) * radius;
                    const ay = cy + Math.sin(angle) * radius;

                    // Sector line
                    c.ctx.strokeStyle = '#ffffff10';
                    c.ctx.beginPath();
                    c.ctx.moveTo(cx, cy);
                    c.ctx.lineTo(ax, ay);
                    c.ctx.stroke();

                    // Attractor
                    c.ctx.fillStyle = colors[i];
                    c.ctx.beginPath();
                    c.ctx.arc(ax, ay, 10, 0, Math.PI * 2);
                    c.ctx.fill();

                    // Degree label
                    c.ctx.fillStyle = '#fff';
                    c.ctx.font = 'bold 10px Inter, sans-serif';
                    c.ctx.textAlign = 'center';
                    c.ctx.textBaseline = 'middle';
                    c.ctx.fillText(degrees[i], ax, ay);
                }

                // Two orbiting particles
                const orbitR = 40;
                const p1x = cx + orbitR * Math.sin(time * 1.8) * Math.cos(time * 1.3);
                const p1y = cy + orbitR * Math.cos(time * 1.5) * Math.sin(time * 1.7);
                const p2x = cx + orbitR * Math.sin(time * 1.8 + 0.5) * Math.cos(time * 1.3 + 0.3);
                const p2y = cy + orbitR * Math.cos(time * 1.5 + 0.4) * Math.sin(time * 1.7 + 0.2);

                c.trail1.push({ x: p1x, y: p1y });
                c.trail2.push({ x: p2x, y: p2y });
                if (c.trail1.length > 50) c.trail1.shift();
                if (c.trail2.length > 50) c.trail2.shift();

                // Trail 1
                c.ctx.beginPath();
                c.trail1.forEach((p, i) => {
                    if (i === 0) c.ctx.moveTo(p.x, p.y);
                    else c.ctx.lineTo(p.x, p.y);
                });
                c.ctx.strokeStyle = '#22c55e50';
                c.ctx.lineWidth = 2;
                c.ctx.stroke();

                // Trail 2
                c.ctx.beginPath();
                c.trail2.forEach((p, i) => {
                    if (i === 0) c.ctx.moveTo(p.x, p.y);
                    else c.ctx.lineTo(p.x, p.y);
                });
                c.ctx.strokeStyle = '#ef444450';
                c.ctx.lineWidth = 2;
                c.ctx.stroke();

                // Particle 1
                c.ctx.fillStyle = '#22c55e';
                c.ctx.beginPath();
                c.ctx.arc(p1x, p1y, 6, 0, Math.PI * 2);
                c.ctx.fill();

                // Particle 2
                c.ctx.fillStyle = '#ef4444';
                c.ctx.beginPath();
                c.ctx.arc(p2x, p2y, 6, 0, Math.PI * 2);
                c.ctx.fill();
            }

            // Orbifold Walker preview (3D prism projection)
            if (previews.orbifold) {
                const o = previews.orbifold;
                o.ctx.fillStyle = '#030712';
                o.ctx.fillRect(0, 0, o.w, o.h);

                const cx = o.w / 2, cy = o.h / 2;

                // Draw 3D prism (isometric projection)
                const scale = 8;
                const offsetX = -30, offsetY = 20;

                // Project 3D to 2D (simple isometric)
                function project(x, y, z) {
                    return {
                        x: cx + (x - z * 0.5) * scale + offsetX,
                        y: cy + (y * 0.8 - z * 0.3 - x * 0.2) * scale + offsetY
                    };
                }

                // Prism edges (12x6x6 box)
                const edges = [
                    [[0,0,0], [12,0,0]], [[0,6,0], [12,6,0]], [[0,0,6], [12,0,6]], [[0,6,6], [12,6,6]],
                    [[0,0,0], [0,6,0]], [[12,0,0], [12,6,0]], [[0,0,6], [0,6,6]], [[12,0,6], [12,6,6]],
                    [[0,0,0], [0,0,6]], [[12,0,0], [12,0,6]], [[0,6,0], [0,6,6]], [[12,6,0], [12,6,6]]
                ];

                o.ctx.strokeStyle = '#3b82f640';
                o.ctx.lineWidth = 1;
                edges.forEach(([a, b]) => {
                    const p1 = project(a[0], a[1], a[2]);
                    const p2 = project(b[0], b[1], b[2]);
                    o.ctx.beginPath();
                    o.ctx.moveTo(p1.x, p1.y);
                    o.ctx.lineTo(p2.x, p2.y);
                    o.ctx.stroke();
                });

                // Attractor positions (Major, Minor, Dim, Aug at different x)
                const attractors = [
                    { x: 3, y: 4, z: 3, color: '#22c55e' },  // Major
                    { x: 6, y: 3, z: 4, color: '#3b82f6' },  // Minor
                    { x: 9, y: 3, z: 3, color: '#ef4444' },  // Dim
                    { x: 6, y: 4, z: 4, color: '#f59e0b' }   // Aug
                ];

                attractors.forEach(a => {
                    const p = project(a.x, a.y, a.z);
                    o.ctx.fillStyle = a.color;
                    o.ctx.beginPath();
                    o.ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
                    o.ctx.fill();
                });

                // Walker position (chaotic orbit in 3D)
                const wx = 6 + 4 * Math.sin(time * 1.7);
                const wy = 3.5 + 1.5 * Math.sin(time * 2.3) * Math.cos(time * 1.1);
                const wz = 3.5 + 1.5 * Math.cos(time * 1.9);

                const wp = project(wx, wy, wz);
                o.trail.push({ x: wp.x, y: wp.y });
                if (o.trail.length > 60) o.trail.shift();

                // Trail
                o.ctx.beginPath();
                o.trail.forEach((p, i) => {
                    if (i === 0) o.ctx.moveTo(p.x, p.y);
                    else o.ctx.lineTo(p.x, p.y);
                });
                o.ctx.strokeStyle = '#60a5fa50';
                o.ctx.lineWidth = 2;
                o.ctx.stroke();

                // Walker
                o.ctx.fillStyle = '#ffffff';
                o.ctx.beginPath();
                o.ctx.arc(wp.x, wp.y, 7, 0, Math.PI * 2);
                o.ctx.fill();

                // Glow
                o.ctx.fillStyle = '#60a5fa40';
                o.ctx.beginPath();
                o.ctx.arc(wp.x, wp.y, 12, 0, Math.PI * 2);
                o.ctx.fill();
            }

            // Rameau Machine preview
            if (previews.rameau) {
                const r = previews.rameau;
                r.ctx.fillStyle = '#030712';
                r.ctx.fillRect(0, 0, r.w, r.h);

                const cx = r.w / 2, cy = r.h / 2;

                // Function zone rings
                // Subdominante (outer, blue)
                r.ctx.strokeStyle = '#3b82f620';
                r.ctx.lineWidth = 30;
                r.ctx.beginPath();
                r.ctx.arc(cx, cy, 75, 0, Math.PI * 2);
                r.ctx.stroke();

                // Dominante (middle, red)
                r.ctx.strokeStyle = '#ef444420';
                r.ctx.lineWidth = 25;
                r.ctx.beginPath();
                r.ctx.arc(cx, cy, 45, 0, Math.PI * 2);
                r.ctx.stroke();

                // Tonica (center, green)
                r.ctx.fillStyle = '#22c55e15';
                r.ctx.beginPath();
                r.ctx.arc(cx, cy, 25, 0, Math.PI * 2);
                r.ctx.fill();

                // Chord nodes
                const chords = [
                    { id: 'I', func: 'T', radius: 0, angle: 0, color: '#22c55e' },
                    { id: 'V', func: 'D', radius: 45, angle: Math.PI * 0.5, color: '#ef4444' },
                    { id: 'IV', func: 'S', radius: 75, angle: Math.PI * 1.5, color: '#3b82f6' },
                    { id: 'ii', func: 'S', radius: 75, angle: Math.PI * 1.2, color: '#3b82f6' },
                    { id: 'vi', func: 'T', radius: 45, angle: Math.PI * 1.0, color: '#22c55e' },
                    { id: 'viio', func: 'D', radius: 45, angle: Math.PI * 0.7, color: '#ef4444' }
                ];

                // Update active chord based on time
                const chordIndex = Math.floor(time * 0.5) % chords.length;
                r.tension = (Math.sin(time) + 1) / 2;

                chords.forEach((chord, i) => {
                    const x = cx + chord.radius * Math.cos(chord.angle);
                    const y = cy + chord.radius * Math.sin(chord.angle);
                    const isActive = i === chordIndex;

                    // Glow for active
                    if (isActive) {
                        r.ctx.fillStyle = chord.color + '40';
                        r.ctx.beginPath();
                        r.ctx.arc(x, y, 18 + r.tension * 8, 0, Math.PI * 2);
                        r.ctx.fill();
                    }

                    // Node
                    r.ctx.fillStyle = isActive ? chord.color : chord.color + '60';
                    r.ctx.beginPath();
                    r.ctx.arc(x, y, isActive ? 12 : 8, 0, Math.PI * 2);
                    r.ctx.fill();

                    // Label
                    r.ctx.fillStyle = '#fff';
                    r.ctx.font = `${isActive ? 'bold ' : ''}10px Inter, sans-serif`;
                    r.ctx.textAlign = 'center';
                    r.ctx.textBaseline = 'middle';
                    r.ctx.fillText(chord.id, x, y);
                });

                // Zone labels
                r.ctx.fillStyle = '#64748b';
                r.ctx.font = '8px Inter, sans-serif';
                r.ctx.fillText('T', cx, cy + 30);
                r.ctx.fillText('D', cx + 50, cy);
                r.ctx.fillText('S', cx, cy - 80);
            }

            requestAnimationFrame(animate);
        }

        window.addEventListener('load', () => {
            initPreviews();
            animate();
        });
        window.addEventListener('resize', initPreviews);
    </script>
</body>
</html>
